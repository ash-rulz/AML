net = model2network("[Z0][X0|Z0][Z1|Z0][X1|Z1][Z2|Z1][X2|Z2][Z3|Z2]")
#net = model2network("[Z0][X0|Z0]")

cptZ0 = matrix(rep(0.1,10), ncol = 10)
dim(cptZ0) <- c(10)#%%%Dimension has to be provided%%%
dimnames(cptZ0) = list(c("1","2","3","4","5","6","7","8","9","10"))

cptX0 = matrix(
  c(0.2,0.2,0.2,0,0,0,0,0,0.2,0.2,
    0.2,0.2,0.2,0.2,0,0,0,0,0,0.2,
    0.2,0.2,0.2,0.2,0.2,0,0,0,0,0,
    0,0.2,0.2,0.2,0.2,0.2,0,0,0,0,
    0,0,0.2,0.2,0.2,0.2,0.2,0,0,0,
    0,0,0,0.2,0.2,0.2,0.2,0.2,0,0,
    0,0,0,0,0.2,0.2,0.2,0.2,0.2,0,
    0,0,0,0,0,0.2,0.2,0.2,0.2,0.2,
    0.2,0,0,0,0,0,0.2,0.2,0.2,0.2,
    0.2,0.2,0,0,0,0,0,0.2,0.2,0.2
    )
  ,ncol = 10,nrow = 10)
dim(cptX0) <- c(10,10)#%%%dimnames has to be provided after this%%%
dimnames(cptX0) <- list("X0" = c("1","2","3","4","5","6","7","8","9","10"),
                        "Z0" = c("1","2","3","4","5","6","7","8","9","10"))

cptZ1 = matrix(
  c(0.5,0.5,0,0,0,0,0,0,0,0,
    0,0.5,0.5,0,0,0,0,0,0,0,
    0,0,0.5,0.5,0,0,0,0,0,0,
    0,0,0,0.5,0.5,0,0,0,0,0,
    0,0,0,0,0.5,0.5,0,0,0,0,
    0,0,0,0,0,0.5,0.5,0,0,0,
    0,0,0,0,0,0,0.5,0.5,0,0,
    0,0,0,0,0,0,0,0.5,0.5,0,
    0,0,0,0,0,0,0,0,0.5,0.5,
    0.5,0,0,0,0,0,0,0,0,0.5
  )
  ,ncol = 10,nrow = 10)
dim(cptZ1) <- c(10,10)
dimnames(cptZ1) = list("Z1" = c("1","2","3","4","5","6","7","8","9","10"),
                       "Z0" = c("1","2","3","4","5","6","7","8","9","10"))
cptX1 = matrix(
  c(0.2,0.2,0.2,0,0,0,0,0,0.2,0.2,
    0.2,0.2,0.2,0.2,0,0,0,0,0,0.2,
    0.2,0.2,0.2,0.2,0.2,0,0,0,0,0,
    0,0.2,0.2,0.2,0.2,0.2,0,0,0,0,
    0,0,0.2,0.2,0.2,0.2,0.2,0,0,0,
    0,0,0,0.2,0.2,0.2,0.2,0.2,0,0,
    0,0,0,0,0.2,0.2,0.2,0.2,0.2,0,
    0,0,0,0,0,0.2,0.2,0.2,0.2,0.2,
    0.2,0,0,0,0,0,0.2,0.2,0.2,0.2,
    0.2,0.2,0,0,0,0,0,0.2,0.2,0.2
  )
  ,ncol = 10,nrow = 10)
dim(cptX1) <- c(10,10)
dimnames(cptX1) <- list("X1" = c("1","2","3","4","5","6","7","8","9","10"),
                        "Z1" = c("1","2","3","4","5","6","7","8","9","10"))

cptZ2 = matrix(
  c(0.5,0.5,0,0,0,0,0,0,0,0,
    0,0.5,0.5,0,0,0,0,0,0,0,
    0,0,0.5,0.5,0,0,0,0,0,0,
    0,0,0,0.5,0.5,0,0,0,0,0,
    0,0,0,0,0.5,0.5,0,0,0,0,
    0,0,0,0,0,0.5,0.5,0,0,0,
    0,0,0,0,0,0,0.5,0.5,0,0,
    0,0,0,0,0,0,0,0.5,0.5,0,
    0,0,0,0,0,0,0,0,0.5,0.5,
    0.5,0,0,0,0,0,0,0,0,0.5
  )
  ,ncol = 10,nrow = 10)
dim(cptZ2) <- c(10,10)
dimnames(cptZ2) <- list("Z2" = c("1","2","3","4","5","6","7","8","9","10"),
                        "Z1" = c("1","2","3","4","5","6","7","8","9","10"))

cptX2 = matrix(
  c(0.2,0.2,0.2,0,0,0,0,0,0.2,0.2,
    0.2,0.2,0.2,0.2,0,0,0,0,0,0.2,
    0.2,0.2,0.2,0.2,0.2,0,0,0,0,0,
    0,0.2,0.2,0.2,0.2,0.2,0,0,0,0,
    0,0,0.2,0.2,0.2,0.2,0.2,0,0,0,
    0,0,0,0.2,0.2,0.2,0.2,0.2,0,0,
    0,0,0,0,0.2,0.2,0.2,0.2,0.2,0,
    0,0,0,0,0,0.2,0.2,0.2,0.2,0.2,
    0.2,0,0,0,0,0,0.2,0.2,0.2,0.2,
    0.2,0.2,0,0,0,0,0,0.2,0.2,0.2
  )
  ,ncol = 10,nrow = 10)
dim(cptX2) <- c(10,10)
dimnames(cptX2) <- list("X2" = c("1","2","3","4","5","6","7","8","9","10"),
                        "Z2" = c("1","2","3","4","5","6","7","8","9","10"))

cptZ3 = matrix(
  c(0.5,0.5,0,0,0,0,0,0,0,0,
    0,0.5,0.5,0,0,0,0,0,0,0,
    0,0,0.5,0.5,0,0,0,0,0,0,
    0,0,0,0.5,0.5,0,0,0,0,0,
    0,0,0,0,0.5,0.5,0,0,0,0,
    0,0,0,0,0,0.5,0.5,0,0,0,
    0,0,0,0,0,0,0.5,0.5,0,0,
    0,0,0,0,0,0,0,0.5,0.5,0,
    0,0,0,0,0,0,0,0,0.5,0.5,
    0.5,0,0,0,0,0,0,0,0,0.5
  )
  ,ncol = 10,nrow = 10)
dim(cptZ3) <- c(10,10)
dimnames(cptZ3) <- list("Z3" = c("1","2","3","4","5","6","7","8","9","10"),
                        "Z2" = c("1","2","3","4","5","6","7","8","9","10"))

cfit = custom.fit(net, dist = list(Z0 = cptZ0,
                                   X0 = cptX0,
                                   Z1 = cptZ1,
                                   X1 = cptX1,
                                   Z2 = cptZ2,
                                   X2 = cptX2,
                                   Z3 = cptZ3))

junction = compile(as.grain(cfit))
evidence <- setEvidence(junction,
                        nodes = c("X0","X2"),
                        states = c('1','3'))
posterior_Z0 <- querygrain(evidence,
                        nodes = "Z0")
posterior_Z1 <- querygrain(evidence,
                           nodes = "Z1",
                           type = "marginal")

#Jose's solution
library(bnlearn)
library(gRain)

net <- model2network("[Z0][X0|Z0][Z1|Z0][X1|Z1][Z2|Z1][X2|Z2][Z3|Z2]")
plot(net)

cptZ0 <- c(.1,.1,.1,.1,.1,.1,.1,.1,.1,.1)
dim(cptZ0) <- c(10)
dimnames(cptZ0) <- list(c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10"))

cptZ1 <- matrix(c(.5,.5,0,0,0,0,0,0,0,0,
                  0,.5,.5,0,0,0,0,0,0,0,
                  0,0,.5,.5,0,0,0,0,0,0,
                  0,0,0,.5,.5,0,0,0,0,0,
                  0,0,0,0,.5,.5,0,0,0,0,
                  0,0,0,0,0,.5,.5,0,0,0,
                  0,0,0,0,0,0,.5,.5,0,0,
                  0,0,0,0,0,0,0,.5,.5,0,
                  0,0,0,0,0,0,0,0,.5,.5,
                  .5,0,0,0,0,0,0,0,0,.5), nrow=10, ncol=10)
dim(cptZ1) <- c(10,10)
dimnames(cptZ1) <- list("Z1" = c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10"), "Z0" =  c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10"))

cptZ2 <- matrix(c(.5,.5,0,0,0,0,0,0,0,0,
                  0,.5,.5,0,0,0,0,0,0,0,
                  0,0,.5,.5,0,0,0,0,0,0,
                  0,0,0,.5,.5,0,0,0,0,0,
                  0,0,0,0,.5,.5,0,0,0,0,
                  0,0,0,0,0,.5,.5,0,0,0,
                  0,0,0,0,0,0,.5,.5,0,0,
                  0,0,0,0,0,0,0,.5,.5,0,
                  0,0,0,0,0,0,0,0,.5,.5,
                  .5,0,0,0,0,0,0,0,0,.5), nrow=10, ncol=10)
dim(cptZ2) <- c(10,10)
dimnames(cptZ2) <- list("Z2" = c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10"), "Z1" =  c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10"))

cptZ3 <- matrix(c(.5,.5,0,0,0,0,0,0,0,0,
                  0,.5,.5,0,0,0,0,0,0,0,
                  0,0,.5,.5,0,0,0,0,0,0,
                  0,0,0,.5,.5,0,0,0,0,0,
                  0,0,0,0,.5,.5,0,0,0,0,
                  0,0,0,0,0,.5,.5,0,0,0,
                  0,0,0,0,0,0,.5,.5,0,0,
                  0,0,0,0,0,0,0,.5,.5,0,
                  0,0,0,0,0,0,0,0,.5,.5,
                  .5,0,0,0,0,0,0,0,0,.5), nrow=10, ncol=10)
dim(cptZ3) <- c(10,10)
dimnames(cptZ3) <- list("Z3" = c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10"), "Z2" =  c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10"))

cptX0 <- matrix(c(.2,.2,.2,0,0,0,0,0,.2,.2,
                  .2,.2,.2,.2,0,0,0,0,0,.2,
                  .2,.2,.2,.2,.2,0,0,0,0,0,
                  0,.2,.2,.2,.2,.2,0,0,0,0,
                  0,0,.2,.2,.2,.2,.2,0,0,0,
                  0,0,0,.2,.2,.2,.2,.2,0,0,
                  0,0,0,0,.2,.2,.2,.2,.2,0,
                  0,0,0,0,0,.2,.2,.2,.2,.2,
                  .2,0,0,0,0,0,.2,.2,.2,.2,
                  .2,.2,0,0,0,0,0,.2,.2,.2), nrow=10, ncol=10)
dim(cptX0) <- c(10,10)
dimnames(cptX0) <- list("X0" = c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10"), "Z0" =  c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10"))

cptX1 <- matrix(c(.2,.2,.2,0,0,0,0,0,.2,.2,
                  .2,.2,.2,.2,0,0,0,0,0,.2,
                  .2,.2,.2,.2,.2,0,0,0,0,0,
                  0,.2,.2,.2,.2,.2,0,0,0,0,
                  0,0,.2,.2,.2,.2,.2,0,0,0,
                  0,0,0,.2,.2,.2,.2,.2,0,0,
                  0,0,0,0,.2,.2,.2,.2,.2,0,
                  0,0,0,0,0,.2,.2,.2,.2,.2,
                  .2,0,0,0,0,0,.2,.2,.2,.2,
                  .2,.2,0,0,0,0,0,.2,.2,.2), nrow=10, ncol=10)
dim(cptX1) <- c(10,10)
dimnames(cptX1) <- list("X1" = c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10"), "Z1" =  c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10"))

cptX2 <- matrix(c(.2,.2,.2,0,0,0,0,0,.2,.2,
                  .2,.2,.2,.2,0,0,0,0,0,.2,
                  .2,.2,.2,.2,.2,0,0,0,0,0,
                  0,.2,.2,.2,.2,.2,0,0,0,0,
                  0,0,.2,.2,.2,.2,.2,0,0,0,
                  0,0,0,.2,.2,.2,.2,.2,0,0,
                  0,0,0,0,.2,.2,.2,.2,.2,0,
                  0,0,0,0,0,.2,.2,.2,.2,.2,
                  .2,0,0,0,0,0,.2,.2,.2,.2,
                  .2,.2,0,0,0,0,0,.2,.2,.2), nrow=10, ncol=10)
dim(cptX2) <- c(10,10)
dimnames(cptX2) <- list("X2" = c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10"), "Z2" =  c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10"))

netfit <- custom.fit(net,list(Z0=cptZ0, Z1=cptZ1, Z2=cptZ2, Z3=cptZ3, X0=cptX0, X1=cptX1, X2=cptX2))
netcom <- compile(as.grain(netfit))

querygrain(setEvidence(netcom,nodes=c("X0","X2"),states=c("1","3")),c("Z0"))
querygrain(setEvidence(netcom,nodes=c("X0","X2"),states=c("1","3")),c("Z1"))
querygrain(setEvidence(netcom,nodes=c("X0","X2"),states=c("1","3")),c("Z2"))
querygrain(setEvidence(netcom,nodes=c("X0","X2"),states=c("1","3")),c("Z3"))